pipeline:
  build:
    image: ubuntu
    secrets:  [ gcloud_key, github_token ]
    commands:
     - apt-get update > /dev/null
     - apt install --reinstall base-files lsb-release lsb-base -y > /dev/null
     - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
     - echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
     - apt-get update > /dev/null
     - apt install nodejs npm curl yarn -y > /dev/null
     - npm install --prefix ./slspatcherui
     - npm install
     - cd ./slspatcherui
     - npm run-script ebuild
     - npm install -g github-release-cli
     - github-release upload --owner "$${DRONE_REPO_NAMESPACE}" --repo "$${DRONE_REPO_NAME}" --tag 0.0.1 --name 0.0.1 --body "This release contains bug fixes and imporvements, including:\n..." --token $${GITHUB_TOKEN} "./dist/*.zip"
     
  build_tag_deploy: 
    image: ubuntu
    secrets:  [ gcloud_key ]
    when:
      event: tag
    commands:
      - apt install --reinstall base-files lsb-release lsb-base -y > /dev/null
      - apt-get update > /dev/null
      - apt install nodejs npm curl yarn -y > /dev/null
      - npm install -g github-release-cli
      - >-
        github-release upload \
        --owner $${DRONE_REPO_NAMESPACE} \
        --repo $${DRONE_REPO_NAME} \
        --tag $${DRONE_TAG} \
        --name $${DRONE_TAG} \
        --body "This release contains bug fixes and imporvements, including:\n..." \
        latest.yml slspatcher-setup-$${DRONE_TAG}.exe