pipeline:
  build:
    image: ubuntu
    secrets:  [ gcloud_key ]
    commands:
     - apt install --reinstall base-files lsb-release lsb-base -y > /dev/null
     - apt-get update > /dev/null
     - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
     - echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
     - apt-get update > /dev/null
     - apt install nodejs npm curl yarn -y > /dev/null
     - npm install --prefix ./slspatcherui
     - npm install
     - cd ./slspatcherui
     - npm run-script ebuild
  build_tag_deploy: 
    image: ubuntu
    secrets:  [ gcloud_key ]
    when:
      event: tag
    commands:
      - apt install --reinstall base-files lsb-release lsb-base -y > /dev/null
      - apt-get update > /dev/null
      - apt install nodejs npm curl yarn -y > /dev/null
      - npm install -g github-release-cli
      - >-
        github-release upload \
        --owner $${DRONE_REPO_NAMESPACE} \
        --repo $${DRONE_REPO_NAME} \
        --tag $${DRONE_TAG} \
        --name $${DRONE_TAG} \
        --body "This release contains bug fixes and imporvements, including:\n..." \
        latest.yml slspatcher-setup-$${DRONE_TAG}.exe